% Copyright (c) 2012 Taylor Hutt, Logic Magicians Software
%
% This program is free software: you can redistribute it and/or
% modify it under the terms of the GNU General Public License as
% published by the Free Software Foundation, either version 3 of the
% License, or (at your option) any later version.
%
% This program is distributed in the hope that it will be useful, but
% WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
% General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.
%
\chapter{Public API Reference}\label{chap:api}

This chapter describes the public functions present in \lmsbw.

\section{\texttt{declare\_source\_component}}\label{api:declare-source-component}

\begin{tabularx}{\linewidth}{ll|cX}
  \multicolumn{4}{c}{\textbf{Arguments}} \\ \hline

  1 & component name & \xref{api:component} & Component name used
  throughout project. \\

  2 & description & \xref{api:description} & Brief component
  description. \\

  3 & reason & \xref{api:reason} & Reason component is included
  in build. \\

  4 & configuration file & \xref{api:configuration-file} & Full
  pathname of component configuration file. \\

  5 & source directory & \xref{api:source-directory} &
  Full pathname to component's source directory. \\

  6 & prerequisites & \xref{api:prerequisite} &
  Optional space-separated list of component names.
\end{tabularx}

This function allows the declaration of \emph{source-based} components
in a project.

Source-based means that the entire source for the component is
available in a directory tree that is currently accessible on the
machine running the build.  The source tree must have a \makefile at
the top level that will build the source in an \lmsbw-compliant
manner.  See \xref{wrap:component-makefile} for details on \makefile
compliance.

The \emph{component name} must be a valid \make identifier, and
globally unique within the project.

\section{\texttt{component\_attribute\_no\_parallel\_build}}\label{api:component-attribute-no-parallel-build}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline
  1 & component-name & Name of a declared component.
\end{tabularx}

This function forces the component to not recursively build in
parallel by passing ``\texttt{-j~1}'' to its build system.

This attribute is normally not necessary, but can be handy for
components which have a \makefile with incorrect dependencies; bad
dependencies will manifest itself as intermittent failure when being
built with parallelism.

\section{\texttt{component\_attribute\_build\_target}}\label{api:component-attribute-build-target}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline
  1 & component-name & Name of a declared component. \\

  2 & list-of-targets & Space-separated list of targets.
\end{tabularx}

This function changes the target for building a component using the
component's build process from the \emph{default} \make target to the
list of targets provided.

\section{\texttt{component\_attribute\_install\_target}}\label{api:component-attribute-install-target}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component name & Name of a declared component. \\
  2 & list-of-targets & Space-separated list of targets.
\end{tabularx}

This function changes the target for installing a component using the
component's build process from the \texttt{install} \make target to
the list of targets provided.

\section{\texttt{component\_attribute\_api}}\label{api:component-attribute-api}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & list-of-directories &  Space-separated list of directories.
\end{tabularx}

This allows the specification of \emph{install} directories that
contain an exported \emph{API}.

All components that list this component as a prerequisite will
automatically become dependent upon changes to the directories named.

It is the responsibility of the component's build process to populate
the directories named in the second argument using \destdir as their
base directory name; \lmsbw will copy the \destdir directories into
the shared install directory.

The following rules are recommended when creating API directories:

\begin{itemize}
\item Use root-based pathnames

  Because you are going to install everything into \destdir, and
  \lmsbw proper will copy those files into the install directory,
  you should use root-based API directory names.

  For example, \texttt{/usr/include/project}.

\item Use the name of the component in the directory name.

  Use the \emph{report} verb (\xref{usinglmsbw:report}) to find out
  the location of API directories.

\item Standardize on install locations

  If you have header files, they should be placed in:

  \texttt{/usr/include/\emph{component-name}}.

  If you have libraries, put them in
  \texttt{/usr/lib/\emph{component-name}}.

  If you have some other type of files, be sure to reach consensus
  on standardized locations; it will make maintenance much easier.

  Since component names must be unique, the directory names will
  also be unique.  And, this rule allows dependent components to
  easily include your header files, and link with your libraries
  -- because their location will be known.

  See \xref{wrap:using-prerequisite-api} for details on using an API
  exported by a prerequisite component.

\item Install to \destdir

  Install all files into the API directory prefixed with \destdir.

  If you don't prefix with \destdir, your build process will
  likely fail with permission errors on the root-based pathnames.

\end{itemize}

\section{\texttt{component\_attribute\_cflags}}\label{api:cflags}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & cflags-value & \texttt{CFLAGS} value.
\end{tabularx}

This allows the specification of \texttt{CFLAGS} values which are
passed to the component build process.  It is incumbent upon the
component's \makefile to never directly assign to \texttt{CFLAGS};
rather it should append values to the \lmsbw-provided value.

\lmsbw uses the declared value of \texttt{CFLAGS} in the determination
of the build directory; changing \texttt{CFLAGS} will result in a
different build directory, and this results in the correct amount of
rebuilding when the flags are changed.

\section{\texttt{declare\_component\_kind}}\label{api:kind}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & kind & A component \emph{kind}.
\end{tabularx}

This internal function allows the specification of the \texttt{kind}
of the component.

The value is used internally to generate \make rules to build \&
install the component.

See \xref{variables:kind} for the allowed values and semantics of the
second argument.


\section{\texttt{declare\_component\_description}}\label{api:description}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & description & Brief component description.
\end{tabularx}

This function allows the specification of a component's description.

\section{\texttt{declare\_component\_reason}}\label{api:reason}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & reason & Component reason.
\end{tabularx}

This function allows the specification of the \emph{reason} that a
component is included in the build.

See \xref{variables:reason} for the allowed values and semantics of
the second argument.

\section{\texttt{declare\_component\_component}}\label{api:component}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & name & Component name.
\end{tabularx}

This function allows the specification of the name of the component.

\section{\texttt{declare\_component\_prerequisite}}\label{api:prerequisite}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & prerequisites & Space-separated list of components.
\end{tabularx}

This function allows the specification of a list of prerequisite
components.

\lmsbw will ensure that all the named prerequisite components are
built and installed prior to building this component.

The prerequisite components need not have been declared before they
are referenced with this function.

If any prerequisite component's API has changed files, then this
component will be built.

See \xref{intro:build-component-criteria} for details on what triggers
a component to be built.

\section{\texttt{declare\_component\_source\_directory}}\label{api:source-directory}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & absolute-directory & Absolute pathname of source directory.
\end{tabularx}

This function allows the specification of the full pathname to the
source code for the associated component.

The second argument must be the full path of the directory containing
the source, and it must contain the \makefile which builds the
component.

\lmsbw will produce an error if the named directory does not exist.

\section{\texttt{declare\_component\_configuration\_file}}\label{api:configuration-file}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & configuration-file & Absolute pathname of component configuration
  file.
\end{tabularx}

This function allows the specification of the path to the component
configuration file associated with the component.

\lmsbw sets up dependencies so that changes to this file will
automatically force the component's build process to be invoked.


\section{\texttt{component\_attribute\_toolchain}}\label{api:toolchain}

\begin{tabularx}{\linewidth}{ll|X}
  \multicolumn{3}{c}{\textbf{Arguments}} \\ \hline

  1 & component-name & Name of a declared component. \\
  2 & toolchain & Directory of existing toolchain.
\end{tabularx}

The second argument must be a directory name that is present in the
toolchain root directory (\xref{usinglmsbw:toolchain-root}).

See \xref{chap:toolchain-usage} and
\xref{chap:toolchain-configuration} for information on using and
configuring toolchains.
